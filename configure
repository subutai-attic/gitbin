#!/bin/sh

showhelp()
{
cat << ENDHELP

    usage: configure {options}
    Configure git-bin build 
    --static
    Build without dynamic linking to third-party libraries
    --no-tests
    Don't create unit tests
ENDHELP
}

OS="UNKNOWN"

# Detemine OS type
case "$OSTYPE" in
    darwin*) OS="MAC" ;;
    *) OS="LINUX" ;;
esac

echo "Configuring for $OS"

flags="";
debug=1
tests=1
static=
if [ "$OS" == "LINUX" ]; then
    libs="-g -ggdb -lrt -lPocoUtil -lPocoXML -lPocoJSON -lPocoFoundation"
else
    libs="-g -ggdb -lrt -lPocoUtil -lPocoXML -lPocoJSON -lPocoFoundation"
fi

while [ $# -ge 1 ]; do
    case "$1" in
        --static)
            static=1 ;;
            --no-tests)
            tests="" ;;
        --help)
            showhelp
            exit 0
            ;;
        *)
            showhelp
            exit 0
            ;;
    esac

    shift
done

if [ "$static" == "1" ]; then
    if [ "$OS" == "LINUX" ]; then
        libs="-g -ggdb -Wl,-Bdynamic -lrt -Llib -Wl,-static -lPocoUtil -lPocoXML -lPocoJSON  -lPocoFoundation  -Wl,-Bdynamic -lpthread" 
    else
        libs="-g -ggdb -Llib -lPocoUtil -lPocoXML -lPocoJSON -lPocoFoundation -lpthread" 
    fi
fi

echo "# config.make generated by configure script" > config.make
echo "LIBS = $libs" >> config.make

cat <<__EOF__ >> config.make
export LIBS
__EOF__

echo "# config.build generated by configure script" > config.build
cat <<__EOF__ >> config.build
TESTS = $tests
__EOF__
